---
name: 3d
description: 在 Remotion 中使用 Three.js 和 React Three Fiber 实现 3D 内容。
metadata:
  tags: 3d, three, threejs
---

# 在 Remotion 中使用 Three.js 和 React Three Fiber

遵循 React Three Fiber 和 Three.js 的最佳实践。
只需遵循以下 Remotion 特定的规则：

## 前提条件

首先，需要安装 `@remotion/three` 包。
如果尚未安装，请使用以下命令：

```bash
npx remotion add @remotion/three # 如果项目使用 npm
bunx remotion add @remotion/three # 如果项目使用 bun
yarn remotion add @remotion/three # 如果项目使用 yarn
pnpm exec remotion add @remotion/three # 如果项目使用 pnpm
```

## 使用 ThreeCanvas

您必须将 3D 内容包裹在 `<ThreeCanvas>` 中，并包含适当的照明。
`<ThreeCanvas>` 必须具有 `width` 和 `height` 属性。

```tsx
import { ThreeCanvas } from "@remotion/three";
import { useVideoConfig } from "remotion";

const { width, height } = useVideoConfig();

<ThreeCanvas width={width} height={height}>
  <ambientLight intensity={0.4} />              {/* 环境光，强度为 0.4 */}
  <directionalLight position={[5, 5, 5]} intensity={0.8} />  {/* 方向光，位置在 [5, 5, 5]，强度为 0.8 */}
  <mesh>
    <sphereGeometry args={[1, 32, 32]} />      {/* 球体几何体，半径为 1，经纬度分段数为 32 */}
    <meshStandardMaterial color="red" />       {/* 标准网格材质，颜色为红色 */}
  </mesh>
</ThreeCanvas>
```

## 禁止使用不由 `useCurrentFrame()` 驱动的动画

着色器、模型等不得自行动画。
除非由 `useCurrentFrame()` 驱动，否则不允许使用动画。
否则，在渲染过程中会导致闪烁。

禁止使用 `@react-three/fiber` 中的 `useFrame()`。

## 使用 `useCurrentFrame()` 实现动画

使用 `useCurrentFrame()` 来执行动画。

```tsx
const frame = useCurrentFrame();               // 获取当前帧
const rotationY = frame * 0.02;                // 根据帧数计算 Y 轴旋转角度

<mesh rotation={[0, rotationY, 0]}>
  <boxGeometry args={[2, 2, 2]} />             {/* 立方体几何体，尺寸为 2x2x2 */}
  <meshStandardMaterial color="#4a9eff" />     {/* 标准网格材质，颜色为 #4a9eff */}
</mesh>
```

## 在 `<ThreeCanvas>` 内部使用 `<Sequence>`

`<ThreeCanvas>` 内部任何 `<Sequence>` 的 `layout` 属性必须设置为 `none`。

```tsx
import { Sequence } from "remotion";
import { ThreeCanvas } from "@remotion/three";

const { width, height } = useVideoConfig();

<ThreeCanvas width={width} height={height}>
  <Sequence layout="none">                     {/* Sequence 的 layout 属性必须设置为 "none" */}
    <mesh>
      <boxGeometry args={[2, 2, 2]} />         {/* 立方体几何体，尺寸为 2x2x2 */}
      <meshStandardMaterial color="#4a9eff" /> {/* 标准网格材质，颜色为 #4a9eff */}
    </mesh>
  </Sequence>
</ThreeCanvas>
```
